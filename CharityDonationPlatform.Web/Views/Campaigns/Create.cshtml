@model CampaignCreateViewModel
@{
    ViewData["Title"] = "Create Campaign";
}

<section class="py-5" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); min-height: 100vh;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb" style="background: transparent; padding: 0;">
                        <li class="breadcrumb-item">
                            <a asp-controller="Home" asp-action="Index" style="color: #2563eb; text-decoration: none;">
                                <i class="fas fa-home me-1"></i>Home
                            </a>
                        </li>
                        <li class="breadcrumb-item">
                            <a asp-controller="Campaigns" asp-action="Index" style="color: #2563eb; text-decoration: none;">
                                <i class="fas fa-bullhorn me-1"></i>Campaigns
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page" style="color: #64748b;">Create Campaign</li>
                    </ol>
                </nav>

                <!-- Main Card -->
                <div class="card border-0" style="border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden;">
                    <!-- Header -->
                    <div class="card-header border-0 text-center" style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); padding: 40px 30px;">
                        <h2 class="fw-bold mb-2" style="color: white;">
                            <i class="fas fa-plus me-2"></i>Create New Campaign
                        </h2>
                        <p class="mb-0" style="color: rgba(255,255,255,0.9);">Launch a campaign to make a difference</p>
                    </div>

                    <!-- Body -->
                    <div class="card-body" style="padding: 40px 30px;">
                        <form asp-action="Create" method="post" enctype="multipart/form-data">
                            @Html.AntiForgeryToken()
                            <div asp-validation-summary="All" class="alert alert-danger mb-4" role="alert" style="border-radius: 12px; border: none; background-color: #fef2f2; color: #dc2626;"></div>

                            <!-- Campaign Title -->
                            <div class="mb-4">
                                <label asp-for="Title" class="form-label fw-semibold" style="color: #1e293b; font-size: 0.95rem;">Campaign Title</label>
                                <input asp-for="Title" class="form-control" style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;" placeholder="Enter an inspiring campaign title" required />
                                <span asp-validation-for="Title" class="text-danger small"></span>
                            </div>

                            <!-- Description -->
                            <div class="mb-4">
                                <label asp-for="Description" class="form-label fw-semibold" style="color: #1e293b; font-size: 0.95rem;">Campaign Description</label>
                                <textarea asp-for="Description" class="form-control" rows="6" style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease; resize: vertical;" placeholder="Describe your campaign, why it matters, and how funds will be used..." required></textarea>
                                <div class="form-text mt-2" style="color: #64748b;">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Be detailed and inspiring - explain the impact donors will make
                                </div>
                                <span asp-validation-for="Description" class="text-danger small"></span>
                            </div>

                            <!-- Target Amount -->
                            <div class="mb-4">
                                <label asp-for="TargetAmount" class="form-label fw-semibold" style="color: #1e293b; font-size: 0.95rem;">Target Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text" style="background: #f8fafc; border: 2px solid #e2e8f0; border-right: none; border-radius: 12px 0 0 12px; color: #64748b; font-weight: 600;">$</span>
                                    <input asp-for="TargetAmount" class="form-control" type="number" min="1" step="0.01" style="border-radius: 0 12px 12px 0; border: 2px solid #e2e8f0; border-left: none; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;" placeholder="10000" required />
                                </div>
                                <span asp-validation-for="TargetAmount" class="text-danger small"></span>
                            </div>

                            <!-- Date Range -->
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <label asp-for="StartDate" class="form-label fw-semibold" style="color: #1e293b; font-size: 0.95rem;">Start Date</label>
                                    <input asp-for="StartDate" class="form-control" type="date" style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;" required />
                                    <span asp-validation-for="StartDate" class="text-danger small"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="EndDate" class="form-label fw-semibold" style="color: #1e293b; font-size: 0.95rem;">End Date</label>
                                    <input asp-for="EndDate" class="form-control" type="date" style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease;" required />
                                    <span asp-validation-for="EndDate" class="text-danger small"></span>
                                </div>
                            </div>

                            <!-- Campaign Image -->
                            <div class="mb-4">
                                <label asp-for="ImageFile" class="form-label fw-semibold" style="color: #1e293b; font-size: 0.95rem;">Campaign Image</label>
                                <input asp-for="ImageFile" class="form-control" type="file" accept="image/*" style="border-radius: 12px; border: 2px dashed #cbd5e1; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease; background-color: #fafbfc;" />
                                <div class="form-text mt-2" style="color: #64748b;">
                                    <i class="fas fa-camera me-1" style="color: #2563eb;"></i>
                                    Upload an inspiring image for your campaign (recommended: 800x600px or larger)
                                </div>
                                <span asp-validation-for="ImageFile" class="text-danger small"></span>
                            </div>

                            <!-- Active Toggle -->
                            <div class="mb-4">
                                <div class="card" style="background-color: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px;">
                                    <div class="form-check">
                                        <input asp-for="IsActive" class="form-check-input" type="checkbox" style="border-radius: 4px; border: 2px solid #e2e8f0;" />
                                        <label asp-for="IsActive" class="form-check-label fw-semibold" style="color: #1e293b;">
                                            <i class="fas fa-rocket me-2" style="color: #2563eb;"></i>
                                            Launch campaign immediately
                                        </label>
                                    </div>
                                    <div class="form-text mt-2" style="color: #64748b; font-size: 0.9rem;">
                                        When checked, your campaign will be visible to donors right away
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-flex justify-content-between pt-3" style="border-top: 1px solid #e2e8f0;">
                                <a asp-controller="Campaigns" asp-action="Index" class="btn btn-outline-secondary px-4 py-2" style="border-radius: 25px; font-weight: 600; border-color: #cbd5e1; color: #64748b;">
                                    <i class="fas fa-arrow-left me-2"></i>Back to Campaigns
                                </a>
                                <button type="submit" class="btn btn-primary px-5 py-2" id="createCampaignBtn" style="background: linear-gradient(135deg, #2563eb, #1d4ed8); border: none; border-radius: 25px; font-weight: 600; font-size: 1.1rem;">
                                    <i class="fas fa-plus me-2"></i>Create Campaign
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .form-control:focus {
        border-color: #2563eb !important;
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25) !important;
    }

    .form-check-input:checked {
        background-color: #2563eb;
        border-color: #2563eb;
    }

    .form-check-input:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25);
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    }

    .input-group-text {
        font-weight: 600;
    }
</style>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Form submission handling
        document.querySelector('form').addEventListener('submit', function (e) {
            const submitBtn = document.getElementById('createCampaignBtn');
            const title = document.getElementById('Title').value.trim();
            const description = document.getElementById('Description').value.trim();
            const targetAmount = parseFloat(document.getElementById('TargetAmount').value);
            const startDate = new Date(document.getElementById('StartDate').value);
            const endDate = new Date(document.getElementById('EndDate').value);

            // Basic validation
            if (!title) {
                e.preventDefault();
                alert('Please enter a campaign title');
                return false;
            }

            if (!description) {
                e.preventDefault();
                alert('Please enter a campaign description');
                return false;
            }

            if (isNaN(targetAmount) || targetAmount < 1) {
                e.preventDefault();
                alert('Please enter a valid target amount of at least $1');
                return false;
            }

            if (targetAmount > 1000000000) {
                e.preventDefault();
                alert('Target amount cannot exceed $1,000,000,000');
                return false;
            }

            if (startDate >= endDate) {
                e.preventDefault();
                alert('End date must be after start date');
                return false;
            }

            // Show loading state
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating Campaign...';
            submitBtn.disabled = true;

            // Re-enable button after 15 seconds as fallback
            setTimeout(function () {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 15000);

            console.log('Campaign creation form submitted:', {
                title: title,
                description: description.substring(0, 50) + '...',
                targetAmount: targetAmount,
                startDate: startDate,
                endDate: endDate
            });
        });

        // Date validation
        document.addEventListener('DOMContentLoaded', function () {
            const startDateInput = document.getElementById('StartDate');
            const endDateInput = document.getElementById('EndDate');

            function validateDates() {
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(endDateInput.value);
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                if (startDate < today) {
                    startDateInput.setCustomValidity('Start date cannot be in the past');
                } else if (startDate && endDate && startDate >= endDate) {
                    endDateInput.setCustomValidity('End date must be after start date');
                } else {
                    startDateInput.setCustomValidity('');
                    endDateInput.setCustomValidity('');
                }
            }

            startDateInput.addEventListener('change', validateDates);
            endDateInput.addEventListener('change', validateDates);
        });

        // Image preview functionality
        document.getElementById('ImageFile').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                // Check file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    this.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    let preview = document.getElementById('imagePreview');
                    if (!preview) {
                        preview = document.createElement('div');
                        preview.id = 'imagePreview';
                        preview.className = 'mt-3 text-center';
                        document.getElementById('ImageFile').parentNode.appendChild(preview);
                    }

                    preview.innerHTML = `
                                <div class="card" style="border-radius: 12px; background-color: #f8fafc; border: 2px solid #e2e8f0; padding: 15px; max-width: 300px; margin: 0 auto;">
                                    <img src="${e.target.result}" alt="Preview" class="img-fluid" style="border-radius: 8px; max-height: 150px; object-fit: cover;" />
                                    <div class="form-text mt-2" style="color: #64748b;">Campaign image preview</div>
                                    <button type="button" class="btn btn-sm mt-2" onclick="clearImagePreview()" style="background-color: #e2e8f0; color: #64748b; border: none; border-radius: 6px; font-size: 0.8rem;">
                                        <i class="fas fa-times me-1"></i>Remove
                                    </button>
                                </div>
                            `;
                };
                reader.readAsDataURL(file);
            } else {
                const preview = document.getElementById('imagePreview');
                if (preview) {
                    preview.remove();
                }
            }
        });

        // Function to clear image preview
        function clearImagePreview() {
            document.getElementById('ImageFile').value = '';
            const preview = document.getElementById('imagePreview');
            if (preview) {
                preview.remove();
            }
        }
    </script>
}